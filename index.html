<!DOCTYPE html>
<html>
    <head>
        <title>BFRPG Character Sheet</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="css/quill.bubble.css">
        <script src="js/vendor/jquery.js"></script>
        <script src="js/BasicFantasyCharGenerator.js"></script>
        <script src="js/vendor/quill.min.js"></script>
    </head>

    <body class="noisy">
        <h1>BFRPG Character Sheet</h1>
        <div class="content">
            <div><b>Info</b></div>
            <div class="box">
                <ul>
                    <li>
                        <div class="container">
                            <div class="block">
                                Name
                                <input type=text id="attr_name" />
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="container">
                            <div class="block">
                                Race
                                <select id="character_race_select" class="info_select">
                                    <option value="Human" selected>Human</option>
                                    <option value="Elf">Elf</option>
                                    <option value="Dwarf">Dwarf</option>
                                    <option value="Halfling">Halfling</option>
                                </select>
                            </div>
                            <div class="block">
                                Class
                                <select id="character_class_select" class="info_select">
                                    <option value="Fighter" selected>Fighter</option>
                                    <option value="Mage">Mage</option>
                                    <option value="Thief">Thief</option>
                                    <option value="Cleric">Cleric</option>
                                    <option value="FighterMage" disabled>FighterMage</option>
                                </select>
                            </div>
                            <div class="block">
                                Experience
                                <input size="6" id="attr_currentxp" type="text">
                            </div>
                            <div class="block">
                                Level
                                <select id="character_level_select" class="info_select">
                                    <option value="1" selected>1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                </select>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="box">
                <div class="container">
                    <div class="block">
                        <b>Attributes</b>
                        <div class="box">
                            <ul>
                                <li>
                                    <div class=row>
                                        Strength
                                        <span>
                                            <select id="character_strength_select">
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10" selected>10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>
                                            <span id="character_strength_mod" class="mod_span">0</span>
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class=row>
                                        Intelligence
                                        <span>
                                            <select id="character_intelligence_select">
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10" selected>10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>
                                            <span id="character_intelligence_mod" class="mod_span">0</span>
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class=row>
                                        Wisdom
                                        <span>
                                            <select id="character_wisdom_select">
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10" selected>10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>
                                            <span id="character_wisdom_mod" class="mod_span">0</span>
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class=row>
                                        Dexterity
                                        <span>
                                            <select id="character_dexterity_select">
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10" selected>10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>
                                            <span id="character_dexterity_mod" class="mod_span">0</span>
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class=row>
                                        Constitution
                                        <span>
                                            <select id="character_constitution_select">
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10" selected>10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>
                                            <span id="character_constitution_mod" class="mod_span">0</span>
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class=row>
                                        Charisma
                                        <span>
                                            <select id="character_charisma_select">
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10" selected>10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>
                                            <span id="character_charisma_mod" class="mod_span">0</span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="block">
                        <b>Combat</b>
                        <div class="box">
                            <ul>
                                <li>
                                    <div class="row">
                                        Armour Class:
                                        <span>
                                            <span style="float: left;"><input type="number" class="num_span" id="attr_armourac" value="0"></span>
                                            +
                                            <span id="ac_bonus" style="float: none; margin: 0em;">0</span>
                                            =
                                            <span id="attr_currentac" style="float: none; margin: 0em;">0</span>
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Hit Points:
                                        <span style="float: right;">
                                            <span style="float: left;"><input type="number" class="num_span" id="attr_currenthp" style="float: none;" value="0"></span>
                                            /
                                            <input type="number" class="num_span" id="attr_maxhp" style="float: none;" value="0">
                                        </span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Attack Bonus:
                                        <span id="base_attack_bonus">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        &nbsp; Melee:
                                        <span id="melee_attack_bonus">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        &nbsp; Missile:
                                        <span id="ranged_attack_bonus">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Movement
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="block">
                        <b>Equipment</b>
                        <div class="box">
                            <div id="ta_equipment" style="height: fit-content;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="block">
                        Thief Abilities
                        <div class="box">
                            <ul>
                                <li>
                                    <div class="row">
                                        Open Locks:
                                        <span id="openLocks">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Remove Traps:
                                        <span id="removeTraps">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Pick Pockets:
                                        <span id="pickPockets">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Move Silently:
                                        <span id="moveSilently">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Climb Walls:
                                        <span id="climbWalls">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Hide:
                                        <span id="hide">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Listen:
                                        <span id="listen">0</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="block">
                        Saving Throws
                        <div class="box">
                            <ul>
                                <li>
                                    <div class="row">
                                        Death Ray or Poison:
                                        <span id="death">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Magic Wands:
                                        <span id="wands">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Paralysis or Turn to Stone:
                                        <span id="paralysis">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Dragon Breath:
                                        <span id="breath">0</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="row">
                                        Rods, Staves, and Spells:
                                        <span id="spells">0</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="block">
                        Casting
                        <div class="box">
                            <div class="row">
                                Spells per Level:
                                <span id="spells_per_level">None</span>
                            </div>
                            <div class="row">
                                <b>Spellbook</b>
                            </div>
                            <div class="row">
                                <div class="block">
                                    <div class="box">
                                        <div id="ta_spells" style="height: fit-content;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="block">
                        Turn Undead:
                        <div class="box">
                            <div class="block">
                                <ul>
                                    <li>
                                        <div class="row">
                                            Skeleton:
                                            <span id="skeleton">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Zombie:
                                            <span id="zombie">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Ghoul:
                                            <span id="ghoul">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Wight:
                                            <span id="wight">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Wraith:
                                            <span id="wraith">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Mummy:
                                            <span id="mummy">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Spectre:
                                            <span id="spectre">0</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row">
                                            Vampire:
                                            <span id="vampire">0</span>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="block">
                        <b>Special Abilities</b>
                        <br>
                        <div class="callout" id="special_abilities"></div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div>
            <input type="button" class="button" id="roll_ability_scores" value="Roll Scores" />
            <input type="button" class="button" id="toggle_dark_mode" value="Toggle Dark Mode" />
            <input type="checkbox" id="switch_primary" style="margin-left: 15px" onclick="toggleSwitchPrimary()"><label
                for="switch_primary">Switch highest score with Primary attribute.</label>
        </div>

        <div>
            <p>created by <b>vori</b></p>
        </div>

        <script>
            var dark = false;
            var toolbarOptions = [
                ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
                [{ 'list': 'ordered'}, { 'list': 'bullet' }]
            ];

            var editor_equipment = new Quill('#ta_equipment', {
                modules : {
                    toolbar: toolbarOptions
                },
                theme: 'bubble',
                placeholder: "store equipment here"
            });

            var editor_spells = new Quill('#ta_spells', {
                modules : {
                    toolbar: toolbarOptions
                },
                theme: 'bubble',
                placeholder: "record spells here"
            });

            var cg = new BasicFantasyCharGenerator();
            function capitalizeFirstLetter(value) {
                return value.charAt(0).toUpperCase() + value.slice(1);
            }

            function setSpecialAbilities() {
                var tag = $("#special_abilities");
                tag.html("");
                for (x = 0; x < cg.specialAbilities.length; x++) {
                    tag.append("* " + cg.specialAbilities[x] + "<br>");
                }
            }

            function storeSheet() {
                var obj = {
                    'name': $("#attr_name").val(),
                    'xp': $("#attr_currentxp").val(),
                    'race': cg.race,
                    'class': cg.class,
                    'level': cg.level,
                    'currenthp': $("#attr_currenthp").val(),
                    'maxhp': $("#attr_maxhp").val(),
                    'armourac': $("#attr_armourac").val(),
                    'attributes': {
                        'strength': cg.attributes.Strength.score,
                        'intelligence': cg.attributes.Intelligence.score,
                        'wisdom': cg.attributes.Wisdom.score,
                        'dexterity': cg.attributes.Dexterity.score,
                        'constitution': cg.attributes.Constitution.score,
                        'charisma': cg.attributes.Charisma.score
                    },
                    'equipment': editor_equipment.getContents(),
                    'spells': editor_spells.getContents(),
                    'dark': dark
                }
                console.log(obj)
                json = JSON.stringify(obj)
                localStorage.setItem('cgJSON', json);
            }

            function loadSheet() {
                json = JSON.parse(localStorage.getItem('cgJSON'))
                cg.setRace(json.race)
                cg.setAttribute("Strength", json.attributes.strength);
                cg.setAttribute("Dexterity", json.attributes.dexterity);
                cg.setAttribute("Constitution", json.attributes.constitution);
                cg.setAttribute("Intelligence", json.attributes.intelligence);
                cg.setAttribute("Wisdom", json.attributes.wisdom);
                cg.setAttribute("Charisma", json.attributes.charisma);
                cg.setClass(json.class.name)
                cg.setLevel(json.level)
                $("#attr_name").val(json.name);
                $("#attr_currentxp").val(json.xp);
                $("#attr_currenthp").val(json.currenthp);
                $("#attr_maxhp").val(json.maxhp);
                $("#attr_armourac").val(json.armourac);
                $("#character_race_select").val(json.race);
                $("#character_strength_select").val(json.attributes.strength);
                $("#character_dexterity_select").val(json.attributes.dexterity);
                $("#character_constitution_select").val(json.attributes.constitution);
                $("#character_intelligence_select").val(json.attributes.intelligence);
                $("#character_wisdom_select").val(json.attributes.wisdom);
                $("#character_charisma_select").val(json.attributes.charisma);
                $("#character_class_select").val(json.class.name);
                $("#character_level_select").val(json.level);
                setSpecialAbilities();
                editor_equipment.setContents(json.equipment);
                editor_spells.setContents(json.spells);
                $("#ta_equipment").height( $("#ta_equipment")[0].scrollHeight );
                $("#ta_spells").height( $("#ta_spells")[0].scrollHeight );

                if (json.dark === true) {
                    toggleDarkMode();
                }
            }

            function updateSheet() {
                reloadClassSelect();
                reloadRaceSelect();
                reloadAbilitySelects();
                $("#base_attack_bonus").html(cg.baseAttackBonus);
                $("#melee_attack_bonus").html(cg.getMeleeAttackBonus());
                $("#ranged_attack_bonus").html(cg.getRangedAttackBonus());
                $("#ac_bonus").html(cg.attributes.Dexterity.bonus);
                $("#hit_points").html(cg.getTotalHP());
                $("#spells_per_level").html(cg.spells);
                $("#death").html(cg.getDeathRaySave());
                $("#wands").html(cg.getMagicWandsSave());
                $("#paralysis").html(cg.getParalysisSave());
                $("#breath").html(cg.getDragonBreathSave());
                $("#spells").html(cg.getSpellsSave());
                $("#skeleton").html(cg.turnUndead.skeleton);
                $("#zombie").html(cg.turnUndead.zombie);
                $("#ghoul").html(cg.turnUndead.ghoul);
                $("#wight").html(cg.turnUndead.wight);
                $("#wraith").html(cg.turnUndead.wraith);
                $("#mummy").html(cg.turnUndead.mummy);
                $("#spectre").html(cg.turnUndead.spectre);
                $("#vampire").html(cg.turnUndead.vampire);
                $("#ghost").html(cg.turnUndead.ghost);
                $("#openLocks").html(cg.thiefSkills.openLocks);
                $("#removeTraps").html(cg.thiefSkills.removeTraps);
                $("#pickPockets").html(cg.thiefSkills.pickPockets);
                $("#moveSilently").html(cg.thiefSkills.moveSilently);
                $("#climbWalls").html(cg.thiefSkills.climbWalls);
                $("#hide").html(cg.thiefSkills.hide);
                $("#listen").html(cg.thiefSkills.listen);
                setAC();
                setMods();
                setSpecialAbilities();
                storeSheet();
            }

            function reloadRaceSelect() {
                $("#character_race_select option").each(function () {
                    if (cg.races[$(this).val()].allowedClasses.indexOf(cg.class.name) === -1) {
                        $(this).prop("disabled", true);
                    } else {
                        $(this).prop("disabled", false);
                    }
                });
            }

            function reloadClassSelect() {
                $("#character_class_select option").each(function () {
                    if ((cg.classAllowed($(this).val()) === false && !cg.switchPrimary) ||
                        (cg.classAllowed($(this).val()) === false && $(this).val() == "FighterMage")) {
                        $(this).prop("disabled", true);
                    } else {
                        $(this).prop("disabled", false);
                    }
                });
            }

            function reloadAbilitySelects() {
                var abilities = ["strength", "dexterity", "constitution", "intelligence", "wisdom", "charisma"];

                abilities.forEach(function (item) {
                    var attr = item;
                    $("#character_" + attr + "_select option").each(function () {
                        if (cg.abilityAllowed(capitalizeFirstLetter(attr), $(this).val()) === false) {
                            $(this).prop("disabled", true);
                        } else {
                            $(this).prop("disabled", false);
                        }
                        //if (cg.attributes[capitalizeFirstLetter(attr)].score == $(this).val())
                    });
                });
            }

            function toggleSwitchPrimary() {
                cg.setSwitchPrimary($("#switch_primary").prop("checked"));
                setAttributes();
            }

            function setMods() {
                $("#character_strength_mod").text(cg.attributes.Strength.bonus).change();
                $("#character_dexterity_mod").text(cg.attributes.Dexterity.bonus);
                $("#character_constitution_mod").text(cg.attributes.Constitution.bonus);
                $("#character_intelligence_mod").text(cg.attributes.Intelligence.bonus);
                $("#character_wisdom_mod").text(cg.attributes.Wisdom.bonus);
                $("#character_charisma_mod").text(cg.attributes.Charisma.bonus);
            }

            function setAttributes() {
                $("#character_strength_select").val(cg.attributes.Strength.score).change();
                $("#character_dexterity_select").val(cg.attributes.Dexterity.score);
                $("#character_constitution_select").val(cg.attributes.Constitution.score);
                $("#character_intelligence_select").val(cg.attributes.Intelligence.score);
                $("#character_wisdom_select").val(cg.attributes.Wisdom.score);
                $("#character_charisma_select").val(cg.attributes.Charisma.score);
            }

            function setAC() {
                $("#attr_currentac").text(Number(cg.attributes.Dexterity.bonus) + Number($("#attr_armourac").val()))
            }

            function toggleDarkMode() {
                document.body.classList.toggle("dark-mode");
                dark = !dark;
                updateSheet();
            }

            $(document).ready(function () {
                if (!localStorage.getItem("cgJSON")) {
                    cg.setRace("Human");
                    cg.setClass("Fighter");
                    cg.setLevel(1);
                    cg.setAttribute("Strength", 10);
                    cg.setAttribute("Dexterity", 10);
                    cg.setAttribute("Constitution", 10);
                    cg.setAttribute("Intelligence", 10);
                    cg.setAttribute("Wisdom", 10);
                    cg.setAttribute("Charisma", 10);
                } else {
                    loadSheet();
                }
                updateSheet();

                $("#roll_ability_scores").click(function () {
                    cg.generateScores();
                    if (cg.switchPrimary) cg.switchPrimaryAttribute();
                    setAttributes();
                    updateSheet();
                });

                $("#toggle_dark_mode").click(function () {
                    toggleDarkMode();
                });

                $("#character_class_select").change(function () {
                    cg.setClass($("#character_class_select").val());
                    if (cg.switchPrimary) cg.switchPrimaryAttribute();
                    setAttributes();
                    updateSheet();
                });

                $("#character_level_select").change(function () {
                    cg.setLevel($("#character_level_select").val());
                    updateSheet();
                });

                $("#character_race_select").change(function () {
                    cg.setRace($("#character_race_select").val());

                    updateSheet();
                });

                $("#character_strength_select").change(function () {
                    cg.setAttribute("Strength", $("#character_strength_select").val());
                    updateSheet();
                });

                $("#character_dexterity_select").change(function () {
                    cg.setAttribute("Dexterity", $("#character_dexterity_select").val());
                    updateSheet();
                });

                $("#character_constitution_select").change(function () {
                    cg.setAttribute("Constitution", $("#character_constitution_select").val());
                    updateSheet();
                });

                $("#character_wisdom_select").change(function () {
                    cg.setAttribute("Wisdom", $("#character_wisdom_select").val());
                    updateSheet();
                });

                $("#character_intelligence_select").change(function () {
                    cg.setAttribute("Intelligence", $("#character_intelligence_select").val());
                    updateSheet();
                });

                $("#character_charisma_select").change(function () {
                    cg.setAttribute("Charisma", $("#character_charisma_select").val());
                    updateSheet();
                });

                $('#attr_name').on('input',function(){
                    updateSheet();
                });

                $('#attr_currentxp').on('input',function(){
                    updateSheet();
                });
                $('#attr_currenthp').on('input',function(){
                    updateSheet();
                });

                $('#attr_maxhp').on('input',function(){
                    updateSheet();
                });

                $('#attr_armourac').on('input',function(){
                    updateSheet();
                });

                editor_equipment.on('text-change', function() {
                    $('#ta_equipment').height("");
                    $("#ta_equipment").height($("#ta_equipment")[0].scrollHeight);
                    updateSheet();
                });

                editor_spells.on('text-change', function() {
                    $('#ta_spells').height("");
                    $("#ta_spells").height($("#ta_spells")[0].scrollHeight);
                    updateSheet();
                });
            });
        </script>
    </body>
    <div class="piece glow noclick"></div>
    <div class="piece scanlines noclick"></div>


</html>